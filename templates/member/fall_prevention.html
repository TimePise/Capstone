{% extends "member/base.html" %}
<!--pritter-->
{% block title %}ë‚™ìƒ ê°ì§€ ì‹œìŠ¤í…œ{% endblock %}
<!--pritter-->
{% block content %}
<h2>ë‚™ìƒ ê°ì§€ ì‹œìŠ¤í…œ</h2>

<div style="display: flex; gap: 20px">
  <!-- ğŸ“· ì¹´ë©”ë¼ ìŠ¤íŠ¸ë¦¼ + ë²„íŠ¼ -->
  <div
    id="camera-wrapper"
    style="position: relative; width: 800px; height: 500px; background: black"
  >
    <img
      id="pose-stream"
      src="{% url 'pose_estimation_feed' %}"
      style="width: 100%; height: 100%; object-fit: cover"
    />

    <!-- ë³´í˜¸ëª¨ë“œ ë²„íŠ¼ -->
    <button
      id="privacy-btn"
      style="
        position: absolute;
        top: 10px;
        left: 10px;
        padding: 6px 10px;
        font-size: 12px;
        background: purple;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        z-index: 11;
      "
    >
      ë³´í˜¸ëª¨ë“œ
    </button>
  </div>

  <!-- ğŸ§  ë‚™ìƒ ìƒíƒœ í‘œì‹œ -->
  <div style="width: 300px">
    <h3>ë‚™ìƒ ê°ì§€ ìƒíƒœ</h3>
    <div
      id="fall-status"
      style="font-size: 20px; font-weight: bold; color: green"
    >
      ì •ìƒì…ë‹ˆë‹¤
    </div>
  </div>
</div>

<!-- toastr ì•Œë¦¼ CDN -->
<link
  href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css"
  rel="stylesheet"
/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script>
  toastr.options = {
    closeButton: true,
    progressBar: true,
    positionClass: "toast-top-right",
    timeOut: "1500",
  };

  const statusBox = document.getElementById("fall-status");

  // âœ… ë³´í˜¸ëª¨ë“œ í† ê¸€ ìš”ì²­ë§Œ ë³´ë‚´ê³  í™”ë©´ ì˜¤ë²„ë ˆì´ëŠ” ì œê±°
  document.getElementById("privacy-btn").addEventListener("click", function () {
    fetch("{% url 'toggle_privacy_mode' %}")
      .then((res) => res.json())
      .then((data) => {
        if (data.privacy_mode) {
          toastr.success("ğŸ”’ ë³´í˜¸ëª¨ë“œ í™œì„±í™”");
        } else {
          toastr.info("ğŸ”“ ë³´í˜¸ëª¨ë“œ í•´ì œ");
        }
      });
  });

  // âœ… ì‹¤ì‹œê°„ ë‚™ìƒ ê°ì§€ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
  function pollFallStatus() {
    fetch("/fall/fall_status/")
      .then((res) => res.json())
      .then((data) => {
        statusBox.textContent = data.label;
        statusBox.style.color = data.fall ? "red" : "green";
      });
  }

  setInterval(pollFallStatus, 1000); // 1ì´ˆë§ˆë‹¤ ê°ì§€ ìƒíƒœ ê°±ì‹ 
</script>
{% endblock %}
